# Lab Middleware API - Legacy Wrapper ุจุฑุง ุณุณุชู ูพุงุฑุณโูพู

ุงู ูพุฑูฺู ฺฉ **Middleware API** ุงุณุช ฺฉู ุจู ุณุณุชู ูุฏู ุขุฒูุงุดฺฏุงู (Parsipal) ู ฺฉ Frontend ูุฏุฑู React ูุฑุงุฑ ูโฺฏุฑุฏ ู ูุดฺฉูุงุช encodingุ CORS ู ุงููุช ุฑุง ุญู ูโฺฉูุฏ.

## ๐ฏ ูุดฺฉู ู ุฑุงู ุญู

### ูุดฺฉูุงุช:
1. **ุงููุช ูพุงู**: ุฏุชุงุจุณโูุง ูุฏู (SQL Server 2000) ูุณุชููุงู ุจู ุงูุชุฑูุช ูุตู ูุณุชูุฏ
2. **Encoding ูุดฺฉู**: ุฎุฑูุฌ API ูููุชโูุง ุจู ูู ุฑุฎุชู ุฏุงุฑุฏ (Arabic Encoding)
3. **CORS**: ูุฑูุฑฺฏุฑ ุงุฌุงุฒู ุฏุฑุฎูุงุณุช ูุณุชูู ููโุฏูุฏ

### ุฑุงู ุญู:
ฺฉ ูุนูุงุฑ ุณู ูุงู:
- **ูุงู 1**: ุฏุชุงุจุณ ุขุฒูุงุดฺฏุงู (ูุฏู)
- **ูุงู 2**: Backend Middleware (ุงู ูพุฑูฺู) - ุชุจุฏู ู ูพุงฺฉุณุงุฒ ุฏุงุฏู
- **ูุงู 3**: React Frontend - ููุงุด ุฏุงุฏูโูุง ุชูุฒ

## ๐ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ูพุดโูุงุฒูุง:
- Node.js 18+ 
- ุฏุณุชุฑุณ ุจู ุณุณุชู ุขุฒูุงุดฺฏุงู (IP ู Port)

### ูุฑุงุญู ูุตุจ:

1. **ูุตุจ ูุงุจุณุชฺฏโูุง:**
```bash
npm install
```

2. **ุชูุธู ูุงู `.env`:**
```bash
cp .env.example .env
```

ุณูพุณ ูุงู `.env` ุฑุง ูุฑุงุด ฺฉูุฏ:
```env
LAB_API_BASE_URL=http://lab-server-ip:port
LAB_API_AUTH_ENDPOINT=/api/auth
LAB_API_DATA_ENDPOINT=/api/patient-data
LAB_SYSTEM_USERNAME=your_username
LAB_SYSTEM_PASSWORD=your_password
PORT=3001
FRONTEND_URL=http://localhost:3000
```

3. **ุงุฌุฑุง ุณุฑูุฑ:**
```bash
npm start
# ุง ุจุฑุง development:
npm run dev
```

ุณุฑูุฑ ุฑู `http://localhost:3001` ุงุฌุฑุง ูโุดูุฏ.

## ๐ก API Endpoints

### 1. ุงุญุฑุงุฒ ููุช
```http
POST /api/auth/login
Content-Type: application/json

{
  "nationalId": "1234567890",
  "password": "patient_password"
}
```

**ูพุงุณุฎ ูููู:**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "message": "ูุฑูุฏ ููููุชโุขูุฒ ุจูุฏ"
}
```

### 2. ุฏุฑุงูุช ูุณุช ุขุฒูุงุดโูุง
```http
POST /api/patient/tests
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "nationalId": "1234567890"
}
```

**ูพุงุณุฎ:**
```json
{
  "success": true,
  "count": 15,
  "data": [
    {
      "id": "test-001",
      "testName": "ุขุฒูุงุด ุฎูู",
      "patientName": "ูุญูุฏ ุงูู",
      "nationalId": "1234567890",
      "testDate": {
        "jalali": "1402/08/15",
        "formatted": "15 ุขุจุงู 1402"
      },
      "result": "5.2",
      "unit": "mg/dL",
      "referenceRange": "3.5-5.5",
      "status": "normal",
      "labName": "ุขุฒูุงุดฺฏุงู ูพุงุฑุณโูพู"
    }
  ]
}
```

### 3. ุฏุฑุงูุช ุฌุฒุฆุงุช ฺฉ ุขุฒูุงุด
```http
POST /api/patient/test-details
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "nationalId": "1234567890",
  "testId": "test-001"
}
```

## ๐ง ูฺฺฏโูุง

### 1. ุชุจุฏู Encoding
- ุชุจุฏู ุฎูุฏฺฉุงุฑ ุงุฒ Windows-1256 / ISO-8859-6 ุจู UTF-8
- ุญู ูุดฺฉู: `รโฆรยญรโฆรยฏ` โ `ูุญูุฏ`

### 2. ุชุจุฏู ุชุงุฑุฎ ุดูุณ
- ุชุจุฏู ุฎูุฏฺฉุงุฑ ุชุงุฑุฎ ููุงุฏ ุจู ุดูุณ
- ูุฑูุช ุฎุฑูุฌ: `1402/08/15` ู `15 ุขุจุงู 1402`

### 3. ุงููุช
- ูพุณูุฑุฏูุง ุณุณุชู ุขุฒูุงุดฺฏุงู ุฏุฑ Backend ูฺฏูโุฏุงุฑ ูโุดููุฏ
- CORS ุจุฑุง Frontend ุชูุธู ุดุฏู ุงุณุช
- ุชูฺฉูโูุง ูููุช ุจุฑุง ุงุญุฑุงุฒ ููุช

### 4. ูุฏุฑุช ุฎุทุง
- ุฎุทุงูุง ุดุจฺฉู (timeout, connection refused)
- ุฎุทุงูุง ุงุญุฑุงุฒ ููุช (401, 403)
- ุฎุทุงูุง encoding

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```
.
โโโ server.js                 # ูุงู ุงุตู Express
โโโ services/
โ   โโโ labAuthService.js    # ุณุฑูุณ ุงุญุฑุงุฒ ููุช ุจุง ุขุฒูุงุดฺฏุงู
โ   โโโ labDataService.js    # ุณุฑูุณ ุฏุฑุงูุช ุฏุงุฏู ุงุฒ ุขุฒูุงุดฺฏุงู
โโโ utils/
โ   โโโ dataTransformer.js   # ุชุจุฏู encoding ู ุชุงุฑุฎ
โโโ package.json
โโโ .env.example
โโโ README.md
```

## ๐ ุงููุช

- **ูุฑฺฏุฒ** ูุงู `.env` ุฑุง commit ูฺฉูุฏ
- ูพุณูุฑุฏูุง ุณุณุชู ุขุฒูุงุดฺฏุงู ุฑุง ุฏุฑ ฺฉุฏ hardcode ูฺฉูุฏ
- ุงุฒ HTTPS ุฏุฑ production ุงุณุชูุงุฏู ฺฉูุฏ
- Rate limiting ุงุถุงูู ฺฉูุฏ (ูพุดููุงุฏ: `express-rate-limit`)

## ๐ ุนุจโุงุจ

### ูุดฺฉู: "ุงุฑุชุจุงุท ุจุง ุณุณุชู ุขุฒูุงุดฺฏุงู ุจุฑูุฑุงุฑ ูุดุฏ"
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `LAB_API_BASE_URL` ุตุญุญ ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุณุฑูุฑ ุขุฒูุงุดฺฏุงู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
- ุงฺฏุฑ ุงุฒ SSL ุฎูุฏุงูุถุง ุงุณุชูุงุฏู ูโฺฉูุฏุ `rejectUnauthorized: false` ุฑุง ุฏุฑ axios ุงุถุงูู ฺฉูุฏ

### ูุดฺฉู: Encoding ูููุฒ ุฏุฑุณุช ูุณุช
- ููฺฉู ุงุณุช ุณุณุชู ุขุฒูุงุดฺฏุงู ุงุฒ encoding ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ
- ุฏุฑ `dataTransformer.js` encodingโูุง ุฏฺฏุฑ ุฑุง ุงูุชุญุงู ฺฉูุฏ

### ูุดฺฉู: CORS
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู `FRONTEND_URL` ุฏุฑ `.env` ุตุญุญ ุงุณุช
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู Frontend ุงุฒ ููุงู URL ุฏุฑุฎูุงุณุช ูโุฒูุฏ

## ๐ TODO

- [ ] ุงุถุงูู ฺฉุฑุฏู Rate Limiting
- [ ] ุงุถุงูู ฺฉุฑุฏู Logging (Winston)
- [ ] ุงุถุงูู ฺฉุฑุฏู Cache ุจุฑุง ุฏุงุฏูโูุง ูพุฑุชฺฉุฑุงุฑ
- [ ] ุงุถุงูู ฺฉุฑุฏู Unit Tests
- [ ] ูพุดุชุจุงู ุงุฒ XML response (ุงฺฏุฑ ุณุณุชู ุขุฒูุงุดฺฏุงู XML ูโุฏูุฏ)

## ๐ License

ISC

